<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Lev Miserables – SCUMM Prototype (Talleyrand)</title>
<style>
    body {
        margin: 0;
        background: #111;
        font-family: sans-serif;
        user-select: none;
        overflow: hidden;
        color: #eee;
    }

    #game {
        width: 100vw;
        height: 100vh;
        display: flex;
        flex-direction: column;
    }

    /* --- SCENE AREA --- */
    #scene {
        flex: 1;
        position: relative;
        background: black;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #scene img {
        width: 640px;
        height: 400px;
        image-rendering: pixelated;
        border: 2px solid #333;
    }

    /* Hotspot highlighting (debug toggle later) */
    .hotspot {
        position: absolute;
        border: 2px solid rgba(255,255,0,0.2);
        cursor: pointer;
    }

    /* --- VERB UI --- */
    #verbs {
        height: 120px;
        background: #222;
        border-top: 3px solid #444;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
    }

    .verb {
        padding: 8px 16px;
        background: #333;
        color: #eee;
        border-radius: 8px;
        border: 1px solid #555;
        cursor: pointer;
        font-size: 18px;
    }
    .verb.selected {
        background: #88f;
        border-color: #ccf;
    }

    /* Text feedback line */
    #statusLine {
        height: 32px;
        background: #000;
        color: #0f0;
        font-family: monospace;
        padding: 4px 8px;
        border-top: 2px solid #333;
    }

    /* Painting overlay */
    #paintingOverlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.9);
        justify-content: center;
        align-items: center;
        flex-direction: column;
        z-index: 999;
    }
    #paintingOverlay img {
        width: 640px;
        height: 400px;
        border: 3px solid white;
        image-rendering: pixelated;
    }
    #paintingOverlay button {
        margin-top: 20px;
        padding: 12px 20px;
        font-size: 20px;
        cursor: pointer;
    }
</style>
</head>

<body>

<div id="game">

    <!-- Scene -->
    <div id="scene">
        <img id="sceneImage"
             src="https://levmiserables.s3.eu-north-1.amazonaws.com/images/talleyrand_interior_bar.png">
        
        <!-- Hotspot: Painting -->
        <div id="hsPainting" class="hotspot"
             style="left: 410px; top: 80px; width: 90px; height: 90px;"></div>

        <!-- Hotspot: Beer pumps -->
        <div id="hsPumps" class="hotspot"
             style="left: 150px; top: 200px; width: 150px; height: 120px;"></div>

        <!-- Hotspot: Exit -->
        <div id="hsExit" class="hotspot"
             style="left: 10px; top: 150px; width: 80px; height: 180px;"></div>
    </div>

    <!-- Status Line -->
    <div id="statusLine">Welcome to the Talleyrand…</div>

    <!-- Verbs -->
    <div id="verbs">
        <div class="verb selected" data-verb="look">Look</div>
        <div class="verb" data-verb="talk">Talk</div>
        <div class="verb" data-verb="use">Use</div>
        <div class="verb" data-verb="walk">Walk</div>
    </div>

</div>

<!-- Painting Overlay -->
<div id="paintingOverlay">
    <img src="https://levmiserables.s3.eu-north-1.amazonaws.com/images/talleyrand_interior_painting.png">
    <button onclick="closePainting()">Close</button>
</div>

<script>
/* ==== AUDIO SETUP ==== */
const AUDIO = "https://levmiserables.s3.eu-north-1.amazonaws.com/audio/";

let ambience = new Audio(AUDIO + "talleyrand_bar.mp3");
ambience.loop = true;
ambience.volume = 0.7;

let grog = new Audio(AUDIO + "talleyrand_grogsong.mp3");
grog.loop = true;
grog.volume = 1.0;

let paintingMusic = new Audio(AUDIO + "talleyrand_peasant_dance_music_full_length.mp3");
paintingMusic.loop = true;
paintingMusic.volume = 1.0;

/* Start ambience */
ambience.play().catch(() => {});

/* ==== VERB SYSTEM ==== */
let currentVerb = "look";

document.querySelectorAll(".verb").forEach(v => {
    v.addEventListener("click", () => {
        document.querySelectorAll(".verb").forEach(x => x.classList.remove("selected"));
        v.classList.add("selected");
        currentVerb = v.dataset.verb;
        setStatus("Verb: " + currentVerb);
    });
});

function setStatus(msg) {
    document.getElementById("statusLine").textContent = msg;
}

/* ==== HOTSPOT LOGIC ==== */
document.getElementById("hsPainting").onclick = () => {
    if (currentVerb === "look" || currentVerb === "use") {
        openPainting();
    } else setStatus("You can't do that to the painting.");
};

document.getElementById("hsPumps").onclick = () => {
    if (currentVerb === "use") {
        chooseBeer();
    } else {
        setStatus("Beer pumps: shiny, cold and calling your name.");
    }
};

document.getElementById("hsExit").onclick = () => {
    if (currentVerb === "walk") {
        setStatus("You leave the Talleyrand… (prototype ends)");
        ambience.pause();
        grog.pause();
        paintingMusic.pause();
    } else {
        setStatus("Maybe try WALK?");
    }
};

/* ==== PAINTING ==== */
function openPainting() {
    document.getElementById("paintingOverlay").style.display = "flex";
    ambience.pause();
    grog.pause();
    paintingMusic.currentTime = 0;
    paintingMusic.play();
}

function closePainting() {
    document.getElementById("paintingOverlay").style.display = "none";
    paintingMusic.pause();
    ambience.play();
}

/* ==== BEER SELECTION ==== */
function chooseBeer() {
    ambience.pause();
    paintingMusic.pause();
    grog.currentTime = 0;
    grog.play();

    const beer = prompt(
        "Choose your beer:\n" +
        "1. Best Bitter\n" +
        "2. New England IPA\n" +
        "3. Belgian Tripel\n" +
        "4. Roasty Stout\n" +
        "5. Crisp Pilsner\n" +
        "6. Pale Ale\n" +
        "7. House Special"
    );

    grog.pause();
    ambience.play();

    if (!beer) return;

    setStatus("You drink the beer. Lovely stuff.");
}
</script>

</body>
</html>
